

@model LeaMaPortal.Models.AgreementPdcViewModel
<div class="row p-b-25 text-uppercase">
    <span> <strong> Agreement Payment Details </strong> </span>
</div>

<div class="row" id="AgreementPd">
    <div class="col-md-12 document-row">
        <div class="col-md-1 w-md-10">
            @*@Html.EditorFor(model => model.AgreementPd.Month, new { @class = "label-default-remove AgreementPdMonth" })*@
            @Html.LabelFor(m=>m.Month, new { @class = "label-default-remove " })
        </div>
        <div class="col-md-1 w-md-10">
            @Html.LabelFor(model => model.Year, new { @class = "label-default-remove " })
        </div>
        <div class="col-md-1 w-md-13">
            @Html.LabelFor(model => model.Payment_Mode, new { @class = "label-default-remove " })
        </div>
        <div class="col-md-1 w-md-15">
            @Html.LabelFor(model => model.BankName, new { @class = "label-default-remove " })
        </div>
        <div class="col-md-1 w-md-14">
            @Html.LabelFor(model => model.Cheque_No, new { @class = "label-default-remove " })
        </div>
        <div class="col-md-1 w-md-16">
            @Html.LabelFor(model => model.Cheque_Date, new { @class = "label-default-remove " })
        </div>
        <div class="col-md-1 w-md-14">
            @Html.LabelFor(model => model.Cheque_Amount, new { @class = "label-default-remove" })
        </div>
       
    </div>
    <div class="col-md-12 document-row">
        <div class="col-md-1 w-md-10">
            @*@Html.EditorFor(model => model.AgreementPd.Month, new { @class = "label-default-remove AgreementPdMonth" })*@
            @Html.DropDownList("Month", null, "--Select--", new { @class = "form-control master-form-input AgreementPdMonth" })
        </div>
        <div class="col-md-1 w-md-10">
            <input type="number" name="Year" id="Year" step="1" class="master-form-input form-control" onkeypress="allow_only_numbers(event);" min="2010" />
            @*@Html.EditorFor(model => model.Year, new { htmlAttributes = new { @class = "master-form-input form-control", @onkeypress = "allow_only_numbers(event);",@min=DateTime.Now.Year } })*@
        </div>
        <div class="col-md-1 w-md-13">
            @Html.DropDownList("Payment_Mode", null,"--Select--", new { @class = "form-control master-form-input AgreementPdPaymentMode" })
        </div>
        <div class="col-md-1 w-md-15">
            @Html.EditorFor(model => model.BankName, new { htmlAttributes = new { @class = "master-form-input form-control" } })
        </div>
        <div class="col-md-1 w-md-14">
            @Html.EditorFor(model => model.Cheque_No, new { htmlAttributes = new { @class = "master-form-input form-control" } })
        </div>
        <div class="col-md-2">
            @Html.EditorFor(model => model.Cheque_Date, new { htmlAttributes = new { @class = "master-form-input form-control" } })
        </div>
        <div class="col-md-1 w-md-10">
            @Html.EditorFor(model => model.Cheque_Amount, new { htmlAttributes = new { @class = "master-form-input form-control", @onkeypress = "allow_only_Float(event,'Cheque_Amount');" } })
        </div>
        <div class="col-md-1 w-md-10">
            <button class="document-btn" onclick="addAgreementPdcDetails(event);" id="btnAddAgreementPdc">Add</button>
        </div>
    </div>
</div>
<div class="row ht-5">
    &nbsp;
</div>
<input type="hidden" id="AgreementPdcListCount" value="@Model.AgreementPdcList.Count" />
@Html.Partial("_AgreementPdcDetails", Model)

<div class="row">
    @*<div class="col-md-1 w-md-10 pull-right">
            <button class="document-btn">Delete</button>
        </div>*@

</div>
<div class="row ht-5">
    &nbsp;
</div>
<script>
    var AgreementPdCount = parseInt($("#AgreementPdcListCount").val());

    function addAgreementPdcDetails(event) {
        event.preventDefault();
        
        var Month =$("#AgreementPd #Month").val();
        var Year =parseInt($("#AgreementPd #Year").val());
        var Payment_Mode = $("#AgreementPd #Payment_Mode").val();
        var BankName = $("#AgreementPd #BankName").val();
        var Cheque_No = $("#AgreementPd #Cheque_No").val();
        var Cheque_Date = $("#AgreementPd #Cheque_Date").val();
        var Cheque_Amount = parseFloat($("#AgreementPd #Cheque_Amount").val());
        var cYear = new Date().getFullYear();
        //if (Year < cYear)
        //{
        //    $("#masterResultModal").contents().find(".modal-header").removeClass("result-modal-success");
        //    $("#masterResultModal").contents().find(".modal-header").addClass("result-modal-error");
        //    $(".result-title").text("Failure");
        //    $(".result-modal-body span").text("Year should not be past");
        //    $('#masterResultModal').modal('show');
        //    //alert("Year not past");
        //    return;
        //}
       
        if (Month == '' || Year < 2010 || isNaN(Year) || Payment_Mode == '' || $("#AgreementPd #Cheque_Amount").val() == '') {
            $("#masterResultModal").contents().find(".modal-header").removeClass("result-modal-success");
            $("#masterResultModal").contents().find(".modal-header").addClass("result-modal-error");
            $(".result-title").text("Failure");
            $(".result-modal-body span").text("Please fill mandatory fields");
            $('#masterResultModal').modal('show');
            //alert("Please fill mandatory fields");
            return;
        }
        var isExist = isExistAgreementPdc(Month, Year, Payment_Mode, BankName, Cheque_No, Cheque_Date, Cheque_Amount);
        debugger;
        if (isExist) {
            $("#masterResultModal").contents().find(".modal-header").removeClass("result-modal-success");
            $("#masterResultModal").contents().find(".modal-header").addClass("result-modal-error");
            $(".result-title").text("Failure");
            $(".result-modal-body span").text("Record already exists!");
            $('#masterResultModal').modal('show');
            //alert("Already exist");
            return;
        }

        var html = "<tr><td>" +
                      "<input type='hidden' name='AgreementPdcList[" + AgreementPdCount + "].Month' id='AgreementPdcList[" + AgreementPdCount + "].Month' value='" + Month + "' data-name='Month' />" +
                      "<input type='hidden' name='AgreementPdcList[" + AgreementPdCount + "].Year' id='AgreementPdcList[" + AgreementPdCount + "].Year' value='" + Year + "' data-name='Year' />" +
                      "<input type='hidden' name='AgreementPdcList[" + AgreementPdCount + "].Payment_Mode' id='AgreementPdcList[" + AgreementPdCount + "].Payment_Mode' value='" + Payment_Mode + "' data-name='Payment_Mode' />" +
                      "<input type='hidden' name='AgreementPdcList[" + AgreementPdCount + "].BankName' id='AgreementPdcList[" + AgreementPdCount + "].BankName' value='" + BankName + "' data-name='BankName' />" +
                      "<input type='hidden' name='AgreementPdcList[" + AgreementPdCount + "].Cheque_No' id='AgreementPdcList[" + AgreementPdCount + "].Cheque_No' value='" + Cheque_No + "' data-name='Cheque_No' />" +
                      "<input type='hidden' name='AgreementPdcList[" + AgreementPdCount + "].Cheque_Date' id='AgreementPdcList[" + AgreementPdCount + "].Cheque_Date' value='" + Cheque_Date + "' data-name='Cheque_Date' />" +
                      "<input type='hidden' name='AgreementPdcList[" + AgreementPdCount + "].Cheque_Amount' id='AgreementPdcList[" + AgreementPdCount + "].Cheque_Amount' value='" + Cheque_Amount + "' data-name='Cheque_Amount' />" +

                      "<div class='col-md-12 document-row'>" +
                          "<div class='col-md-1 col-md-1 w-md-13'>" + Month + "</div>" +


                          "<div class='col-md-1 w-md-14'>" +

                          Year +

        "</div>" +
        "<div class='col-md-1'>" +
        Payment_Mode +
        "</div>" +
        "<div class='col-md-1 w-md-15'>" +

        BankName +

        "</div>" +
        "<div class='col-md-1 w-md-14'>" +
            Cheque_No +
        "</div>" +
        "<div class='col-md-1 w-md-14'>" +

            Cheque_Date +
        "</div>" +
        "<div class='col-md-1'>" +
            Cheque_Amount +

        "</div>" +
        "<div class='col-md-1'>" +
           "<button class='btn agreementpdclist-remove'>X</button>" +
        "</div>" +
    "</div>" +
"</td>" +
"</tr>";
      

        $("#AgreementPdcDetailsList").append(html);
        AgreementPdCount++;
        $("#AgreementPdcListCount").val(AgreementPdCount);
        //alert($("#AgreementPdcListCount").val(AgreementPdCount));
    }
    function isExistAgreementPdc(Month, Year, Payment_Mode, BankName, Cheque_No, Cheque_Date, Cheque_Amount) {
        
        var isExist = false;
        var existfilelist = document.getElementById('AgreementPdcDetailsList');
        var newindex = 0;
        $(existfilelist).find('> tbody > tr').each(function () {
            var existMonth = "";
            var existYear = "";
            var existPayment_Mode = "";
            $(this).find("input").each(function () {
                var dataname = $(this).data("name");
                //alert(dataname + $(this).val() + '-' + newindex)
                switch(dataname)
                {
                    case "Month":
                        existMonth = $(this).val();
                        break;
                    case "Year":
                        existYear = $(this).val();
                        break;
                    case "Payment_Mode":
                        existPayment_Mode = $(this).val();
                        break;
                    case "BankName":
                        existBankName = $(this).val();
                        break;
                    case "Cheque_No":
                        existCheque_No = $(this).val();
                        break;
                    case "Cheque_Date":
                        existCheque_Date = $(this).val();
                        break;
                    case "Cheque_Amount":
                        existCheque_Amount = $(this).val();
                        break;
                }
                
            });

            if (Month == existMonth && Year == existYear && existPayment_Mode == Payment_Mode && existBankName == BankName && Cheque_No == existCheque_No && Cheque_Date == existCheque_Date && existCheque_Amount == Cheque_Amount)
            {
                isExist = true;
            }

        });
        return isExist;
    }
    function removeAgreementPdcDetails() {
         
        $(this).closest('tr').remove();
        var existfilelist = document.getElementById('AgreementPdcDetailsList');
        var newindex = 0;
        $(existfilelist).find('> tbody > tr').each(function () {

            $(this).find("input").each(function () {
                var dataname = $(this).data("name");
                //alert(dataname + $(this).val() + '-' + newindex)
                $(this).attr({
                    'id': function (_, id) {
                        return id + newindex
                    },
                    'name': function (_, name) {
                        //return name + iTenantDocument[0].Name
                        return 'AgreementPdcList[' + newindex + '].' + dataname
                    }
                });
            });

            newindex++;

        });
        k = newindex;
    };




    $(document).on('click', 'button.agreementpdclist-remove', function () {
        $(this).closest('tr').remove();
        var existfilelist = document.getElementById('AgreementPdcDetailsList');
        var newindex = 0;
        $(existfilelist).find('> tbody > tr').each(function () {

            $(this).find("input").each(function () {
                var dataname = $(this).data("name");
                //alert(dataname + $(this).val() + '-' + newindex)
                $(this).attr({
                    'id': function (_, id) {
                        return id + newindex
                    },
                    'name': function (_, name) {
                        //return name + iTenantDocument[0].Name
                        return 'AgreementPdcList[' + newindex + '].' + dataname
                    }
                });
            });

            newindex++;

        });
        AgreementPdCount = newindex;
        $("#AgreementPdcListCount").val(AgreementPdCount);
    });
    $("#Payment_Mode").change(function () {
        //alert("Hijbmn");
        var type = $("#Payment_Mode").val();
        if (type != undefined && (type != "Cash")) {
            $('#BankName').removeAttr('disabled');
            $('#Cheque_No').removeAttr('disabled');
            $('#Cheque_Date').removeAttr('disabled');
            //$("SecurityChequeno").prop("disabled", false);
            //$("SecurityChequedate").prop("disabled", false);
        }
        else {
            $('#BankName').attr('disabled', true);
            $('#Cheque_No').attr('disabled', true);
            $('#Cheque_Date').attr('disabled', true);
            $('#BankName').val('');
            $('#Cheque_No').val('');
            $('#Cheque_Date').val('mm/dd/yyyy');
        }
        

        //if (type == "Cheque") {
        //    $("#Cheque_No").attr("disabled", false);
        //    $("#Cheque_Date").attr("disabled", false);
        //}
        //else {
        //    $("#Cheque_No").val('');
        //    $("#Cheque_Date").val('');
        //    $("#Cheque_No").attr("disabled", true);
        //    $("#Cheque_Date").attr("disabled", true);
        //}
        return;
    });
    
</script>